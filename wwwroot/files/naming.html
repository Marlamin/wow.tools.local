
<!DOCTYPE html>
<html data-bs-theme="dark">
<head>
    <title>WoW.tools</title>
    <meta property='og:type' content='website'>
    <meta property='og:site_name' content='WoW.tools'>
    <meta property='og:title' content='WoW.tools'>
    <meta property='og:image' content='/img/cogw.png'>
    <meta property='twitter:image' content='/img/cogw.png'>
    <meta property='twitter:card' content='summary'>
    <meta property='twitter:site' content='@Marlamin'>
    <meta name='application-name' content='WoW.tools'>
    <meta name='apple-mobile-web-app-title' content='WoW.tools'>
    <meta name='theme-color' content='#343a40'>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="icon" type="image/png" href="/img/cogw.png" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="/css/font-awesome.min.css" />

    <!-- JQuery -->
    <script src="/js/jquery.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/bootstrap.bundle.min.js"></script>

    <!-- Datatables -->
    <link rel="stylesheet" type="text/css" href="/css/datatables.min.css" />
    <script type="text/javascript" src="/js/datatables.min.js"></script>
    <script src="/js/input.js" crossorigin="anonymous"></script>

    <link href="/css/style.css?v=1661289414" rel="stylesheet">
    <script type="text/javascript" src="/js/main.js"></script>
    <script type="text/javascript" src="/js/anims.js"></script>
    <script type="text/javascript" src="/js/bufo.js"></script>
    <script type="text/javascript" src="/js/js-blp.js"></script>
    <style type="text/css">
        html{
            zoom: 80%;
        }
        .table{
            font-size: 13px;
        }

        #overlay{
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 500px;
            height: 500px;
            background-color: rgba(0, 0, 0, 0.63);
            z-index: 3;
            pointer-events: none;
        }

        #resultHolder {
            position: fixed;
            bottom: 10px;
            left: 10px;
            width: auto;
            min-width: 130px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.80);
            z-index: 3;
        }

        #collapseResults{
            position: absolute;
            top: 5px;
            right: 10px;
            cursor: pointer;
        }

        #resultTitle{
            margin-right: 20px;
        }

        .collapsed {
            display: none;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg" id="navbar"></nav>
    <div class="container-fluid" id='naming_container'>
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link" id="namers-tab" data-bs-toggle="tab" href="#namers" role="tab" aria-controls="namers" aria-selected="false">Automatic namers</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="lookup-tab" data-bs-toggle="tab" href="#lookup" role="tab" aria-controls="lookup" aria-selected="false">Filename checks</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" id="manual-tab" data-bs-toggle="tab" href="#manual" role="tab" aria-controls="m2" aria-selected="true">Manual models</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade" id="namers" role="tabpanel" aria-labelledby="namers-tab">
                <div class='row'>
                    <div class="col-md-6">
                        <p>Various namers can be run on the current build to find/suggest new filenames. Keep in mind that some namers might take a while, progress/any errors can be seen in the console. Might behave badly on non-mainline/new builds.</p>
                        <h4>Available namers</h4>
                        <table class="table table-sm table-striped">
                            <thead><tr><th>Name</th><th>Description</th></tr></thead>
                            <tbody>
                                <tr><td>Anima</td><td>Anima system textures (unused since SL).</td></tr>
                                <tr><td>Baked NPC textures</td><td>Baked NPC textures (textures/bakednpctextures).</td></tr>
                                <tr><td>Character Customization textures</td><td>Guess.</td></tr>
                                <tr><td>Content hashes</td><td>Naming by file contents (shared textures).</td></tr>
                                <tr><td>Collectables</td><td>(Unstable) Naming from the collectable system.</td></tr>
                                <tr><td>Color grading</td><td>Environment color grading textures.</td></tr>
                                <tr><td>CreatureDisplayInfo textures</td><td>Creature model skins referenced by CreatureDisplayInfo.</td></tr>
                                <tr><td>DBFilesClient</td><td>Names DB2 files based on the manifest.json file from the WoWDBDefs repo.</td></tr>
                                <tr><td>Decals</td><td>Textures related to decals.</td></tr>
                                <tr><td>Emote sounds</td><td>Character emote sounds.</td></tr>
                                <tr><td>Full screen effects</td><td>Full screen effect textures.</td></tr>
                                <tr><td>GameObject DisplayInfo</td><td>Doodad sound naming based on GameObjectDisplayInfo.db2.</td></tr>
                                <tr><td>Interface files</td><td>Names interface files from ManifestInterfaceData.db2.</td></tr>
                                <tr><td>Item textures</td><td>Item textures referenced from ItemDisplayInfo* DB2s.</td></tr>
                                <tr><td>M2 models</td><td>Generates automatic (largely placeholder) names for M2 models and related files. <br /><b style="color: red">Note:</b> Will take several minutes!</td></tr>
                                <tr><td>Map</td><td>Map-based naming of WDT, WDL, ADT, minimaps and maptextures. <br /><b style="color: red">Note:</b> Will take several minutes!</td></tr>
                                <tr><td>Music</td><td>Music referenced from SceneScripts, ZoneMusic.db2 and ZoneIntroMusicTable.db2.</td></tr>
                                <tr><td>Player Housing</td><td>Names player housing related models and WMOs.</td></tr>
                                <tr><td>SoundKits</td><td>Name sound files based on various sources.</td></tr>
                                <tr><td>Spell textures</td><td>Very specific spell textures (chain effects and blendsets).</td></tr>
                                <tr><td>Terrain Cube Maps</td><td>Cube maps used for reflections of terrain, also names liquid textures.</td></tr>
                                <tr><td>Voice dialog (NPC)</td><td>Requires a data recording addon with recorded in-game data. Currently supported: <a href="https://www.curseforge.com/wow/addons/datamine" target="_blank">Datamine</a>, WoWDB Profiler, Wowhead Looter.</td></tr>
                                <tr><td>WMO models</td><td>Generates automatic (largely placeholder) names for WMO models. <br /><b style="color: red">Note:</b> Will take several minutes!</td></tr>
                                <tr><td>WWF files</td><td>Weather particulate files used to show various environmental particle effects.</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h4>Settings</h4>
                        <form method="post" class="form" id="namingForm">
                            <div class="form-group">
                                <label for="creatureCacheWDBFilename">creaturecache.wdb location override (creaturecache is used for creature model and creature voice over naming)</label>
                                <input type="text" class="form-control" id="creatureCacheWDBFilename" name="creatureCacheWDBFilename" placeholder="Override creaturecache.wdb location (default from retail WoW)">
                            </div>
                            <label for="namers">Select one or all namers below (default: all)</label>
                            <select style="height: 500px" multiple class="form-control" id="namers" name="namers">
                                <option value="Anima" selected>Anima system textures</option>
                                <option value="BakedNPC" selected>Baked NPC textures</option>
                                <option value="CharCust" selected>Character Customization textures</option>
                                <option value="ContentHashes" selected>Content hashes</option>
                                <option value="Collectables" selected>Collectables</option>
                                <option value="ColorGrading" selected>Color grading</option>
                                <option value="CDI" selected>CreatureDisplayInfo textures</option>
                                <option value="DB2" selected>DBFilesClient</option>
                                <option value="Decals" selected>Decals</option>
                                <option value="Emotes" selected>Emote sounds</option>
                                <option value="FSE" selected>Full screen effects</option>
                                <option value="GDI" selected>GameObject DisplayInfo</option>
                                <option value="Interface" selected>Interface files</option>
                                <option value="ItemTex" selected>Item textures</option>
                                <option value="M2" selected>M2 models</option>
                                <option value="Map" selected>Map</option>
                                <option value="Music" selected>Music</option>
                                <option value="PlayerHousing" selected>Player Housing</option>
                                <option value="SoundKits" selected>SoundKits</option>
                                <option value="SpellTex" selected>Spell textures</option>
                                <option value="TerrainCubeMaps" selected>Terrain Cube Maps and liquids</option>
                                <option value="VO" selected>NPC dialog (requires data profiler addon)</option>
                                <option value="WMO" selected>WMO models</option>
                                <option value="WWF" selected>WWF files</option>
                            </select>
                            <br>
                            <div class="form-check">
                                <input id="overrideVO" type='checkbox' name='overrideVO' class="form-check-input" CHECKED /> <label class="form-check-label" for="overrideVO">Override VO? (uncheck to only add new names)</label>
                            </div>
                            <div class="form-check">
                                <input id="allowCaseRenames" type='checkbox' name='allowCaseRenames' class="form-check-input" /> <label class="form-check-label" for="allowCaseRenames">Allow casing-only renames?</label>
                            </div>
                            <input type="submit" id="submitButton" class="btn btn-success form-control" value="Engage!">
                        </form>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="lookup" role="tabpanel" aria-labelledby="lookup-tab">
                <h4 id="filenameInput">Filenames to check</h4>
                <p>Paste filenames here (1 per line) to check them against known filename lookups (largely Classic only). Valid names will be posted in results.</p>
                <textarea id="filesToCheck" rows="15" cols="160"></textarea>
                <br />
                <a id="checkFilesButton" style="cursor: pointer" class="btn btn-primary" onclick="checkFiles()">Check files</a>
            </div>
            <div class="tab-pane fade show active" id="manual" role="tabpanel" aria-labelledby="manual-tab">
                <div class="row">
                    <div class="col-md-3">
                        <div id="modelList">
                            <table id='files' class="table table-striped table-bordered table-condensed" cellspacing="0" style='margin: auto; ' width="100%">
                                <thead>
                                    <tr>
                                        <th style='width: 50px;'>ID</th>
                                        <th>Filename</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="modelPreview">
                            Model preview
                        </div>
                        <div id="nameForm">
                            <div class="input-group">
                                <input type="text" class="form-control" id="filename" name="name" placeholder="File name"><br />
                                <div class="input-group-append">
                                    <button class="btn btn-primary" onclick="setSuffix('.m2')">.m2</button>
                                    <button class="btn btn-primary" disabled>.wmo</button>
                                    <button class="btn btn-danger" onclick="loadLastName()">Last</button>
                                </div>
                            </div>
                            <button id="nameButton" class="btn btn-success form-control" style="margin-top:4px;">Name file</button>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <h4>M2 naming prefixes</h4>
                                <div class="row">
                                    <!--
                                    <div class="col-md-4">
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/10XP_')">10 Generic</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Highlands/10HGL_Highlands_')">10 Highlands</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Primalist/10PM_Primalist_')">10 Primalist</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Dragon/10DG_Dragon_')">10 Dragon</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Grasslands/10GSL_Grasslands_')">10 Grasslands</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Dungeon/10DU_Dungeon_')">10 Dungeon</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Tuskarr/10TS_Tuskarr_')">10 Tuskarr</button> <br />
                                    </div>
                                    -->
                                    <div class="col-md-4">
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Volcanic/10CAN_Volcanic_')">10 Volcanic</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Djaradin/10DJ_Djaradin_')">10 Djaradin</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Reliquary/10RQ_Reliquary_')">10 Reliquary</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/ExplorersLeague/10EL_ExplorersLeague_')">10 Explorers</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Titan/10TI_Titan_')">10 Titan</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/EmeraldDream/10ED_EmeraldDream_')">10 ED</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion09/Doodads/Centaur/10CT_Centaur_')">10 Centaur</button> <br />
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/11XP_')">11 Generic</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/Earthen/11EA_Earthen_')">11 Earthen</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/Arathor/11AT_Arathor_')">11 Arathi</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/Nerubian/11NB_Nerubian_')">11 Nerubian</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/Rootlands/11RTL_Rootlands_')">11 Harronir (RTL)</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/Kobold/11KO_Kobold_')">11 Kobold</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/Kobyss/11KB_Kobyss_')">11 Kobyss</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/Goblin/11GO_Goblin_')">11 Goblin</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/Ethereal/11ET_Ethereal_')">11 Ethereal</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion10/Doodads/Broker/11BO_Brokers_')">11 Brokers</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/WildElves/11WE_WildElves_')">11 WildElves</button> <br />
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/12XP_')">12 Root</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/Generic/12XP_Generic_')">12 Generic</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/PlayerHousing/12PH_')">12 Housing</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/Elwynn/12ELW_Elwynn_')">12 Elwynn</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/Durotar/12DUR_Durotar_')">12 Durotar</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/BloodElf/12BE_BloodElf_')">12 BloodElf</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/Troll/12TR_Troll_')">12 Troll</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/Void/12VD_Void_')">12 Void</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/VoidElf/12VE_VoidElf_')">12 VoidElf</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/Fungarian/12FN_Fungarian_')">12 Fungarian</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/Primitive/12PM_Primitive_')">12 Primitive</button> <br />
                                        <button class="btn btn-primary" onclick="setPrefix('World/Expansion11/Doodads/Rutaani/12RU_Rutaani_')">12 Rutaani</button> <br />
                                    </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5" style="max-height: 100vh; overflow-y: scroll">
                        <div id="modelInfo">
                            Info
                        </div>
                    </div>
                </div>
 
            </div>
        </div>
    </div>
    <div id="resultHolder">
        <h4 id="resultTitle">Result</h4>
        <a onClick="toggleResults()" id="collapseResults"><i id="collapseResultsIcon" class="fa fa-expand"></i></a>
        <div id="collapsableResult" class="collapsed">
            <p><b><a href="#" onClick="resultsAsTxt()">Download</a></b> as a .txt file and <a href="https://github.com/wowdev/wow-listfile/issues/new?assignees=&labels=suggestion&projects=&template=csv-listfile-suggestion.md&title=CSV+listfile+suggestion" target="_BLANK">submit an issue on GitHub</a> (login required) with the .txt file attached to submit these names to the community listfile.</p>
            <textarea id="result" rows="15" cols="140">Nothing here yet.</textarea><br />
            <button onclick="clearNames()" class="btn btn-danger">Clear new name cache</button>
        </div>
    </div>
    <div id="overlay" style="min-width: 700px;">
    </div>
    <script src="/js/files.js"></script>
    <script type='text/javascript'>
        const namingForm = document.getElementById("namingForm");
        const submitButton = document.getElementById("submitButton");
        const result = document.getElementById("result");
        const resultTitle = document.getElementById("resultTitle");
        const collapsableResult = document.getElementById("collapsableResult");

        var Elements = {
            table: null,
            currentID: 0
        };

        var lastName = "";

        function toggleResults() {
            if (collapsableResult.classList.contains("collapsed")) {
                collapsableResult.classList.remove("collapsed");
                collapseResultsIcon.classList.remove("fa-expand");
                collapseResultsIcon.classList.add("fa-window-minimize");
            }
            else {
                collapsableResult.classList.add("collapsed");
                collapseResultsIcon.classList.add("fa-expand");
                collapseResultsIcon.classList.remove("fa-window-minimize");

            }
        }

        function setPrefix(name) {
            document.getElementById("filename").value = name;
        }

        function setSuffix(suffix) {
            var filenameInput = document.getElementById("filename");
            var name = filenameInput.value;

            if (!name.endsWith(suffix)) {
                filenameInput.value = name + suffix;
            }

            document.getElementById("nameButton").disabled = false;
        }

        function loadLastName() {
            var filenameInput = document.getElementById("filename");
            filenameInput.value = lastName;
        }

        namingForm.onsubmit = function (e) {
            e.preventDefault();

            submitButton.disabled = true;
            submitButton.classList.add("disabled");
            submitButton.value = "Naming, you can keep an eye on the console for progress... ";

            var data = new FormData(namingForm);

            fetch('/naming/start', {
                method: 'POST',
                body: data,
            }).then(function (response) {
                return response.text();
            }).then(function (data) {
                var numResults = data.split('\n').length;
                if (data.length == 0)
                    numResults = 0;

                resultTitle.innerHTML = "Result (" + numResults + " names)";
                result.innerHTML = data;
                submitButton.disabled = false;
                submitButton.classList.remove("disabled");
                submitButton.value = "Engage!";

                fetch("/listfile/clearCache", { method: 'GET' });
            });
        }

        function resultsAsTxt() {
            var fakeLink = document.createElement("a");
            fakeLink.href = "data:text/plain;charset=UTF-8," + encodeURIComponent(result.value);
            fakeLink.setAttribute("download", "WTL-suggestions.txt");
            fakeLink.click();
        }
        function clearNames() {
            fetch('/naming/clear', {
                method: 'GET'
            });
            result.innerHTML = "Nothing here yet.";
        }

        (function () {
            var page = 0;
            var searchString = "type:m2,added:11.2.5.63286|current";
            var sortCol = 0;
            var sortDesc = "asc";

            Elements.table = $('#files').DataTable({
                "processing": true,
                "serverSide": true,
                "search": { "search": searchString },
                "ajax": {
                    url: '/listfile/files',
                    type: 'GET'
                },
                "pageLength": 30,
                "language": {
                    "search": "Search: _INPUT_",
                    "info": "_START_ to _END_ of _TOTAL_ files",
                    "infoFiltered": ""
                },
                "displayStart": page * 30,
                "autoWidth": false,
                "lengthMenu": [
                    [15, 25, 50, 100, 1000, -1],
                    [15, 25, 50, 100, 1000, "All"]
                ],
                "orderMulti": false,
                "order": [[sortCol, sortDesc]],
                "columnDefs": [
                    {
                        "targets": 1,
                        "createdCell": function (td, cellData, rowData, row, col) {
                            if (!cellData) {
                                if (!rowData[7]) {
                                    $(td).css('background-color', '#ff585850');
                                } else {
                                    $(td).css('background-color', '#673ab750');
                                }
                            }
                        },
                        "render": function (data, type, full, meta) {
                            if (full[1]) {
                                var test = full[1];
                            } else {
                                var test = "";
                                if (full[7]) {
                                    test = full[7];
                                }
                            }

                            if (full[2]) {
                                test += "<span style='float: right'><a tabindex='0' role='button' data-bs-trigger='hover' data-bs-container='body' data-bs-html='true' data-bs-toggle='popover' style='color: ;'";

                                if (full[8] == "true") {
                                    test += "data-bs-content='Lookup " + full[2] + " matches filename'><i class='text-success fa fa-check'></i>&nbsp;</a>";
                                } else {
                                    if (full[1]) {
                                        test += "data-bs-content='Lookup " + full[2] + " does not match filename'><i class='text-danger fa fa-close'></i>&nbsp;</a>";
                                    } else {
                                        test += "data-bs-content='Lookup " + full[2] + " does not match unknown filename'><i class='text-warning fa fa-question'></i>&nbsp;</a>";
                                    }
                                }

                                test += "</span>";
                            }

                            return test;
                        }
                    }
                ]
            });

            $("#files").on('draw.dt', function () {
                if (Elements.currentID == 0) {
                    if (Elements.table.rows().count() > 0) {
                        const data = Elements.table.row(0).data();
                        Elements.currentID = data[0];
                        loadFile(data[0], data[1]);
                    }
                }

                var currentSearch = encodeURIComponent($("#dt-search-0").val());
                var currentPage = $('#files').DataTable().page() + 1;

                var sort = $('#files').DataTable().order();
                var sortCol = sort[0][0];
                var sortDir = sort[0][1];

                var build = $('#files').DataTable().ajax.url().split("buildConfig=")[1];

                var url = "search=" + currentSearch + "&page=" + currentPage + "&sort=" + sortCol + "&desc=" + sortDir;
                if (build) {
                    url += "&build=" + build;
                }

                window.location.hash = url;

                $('.popover').remove();

                $("[data-bs-toggle=popover]").popover();
            });

            $("#files").on('click', 'tbody tr td', function () {
                var data = Elements.table.row($(this).parent()).data();

                $(".selected").removeClass("selected");
                $(this).parent().addClass('selected');

                Elements.currentID = data[0];
                loadFile(data[0], data[1]);
            });

            function loadFile(id, name) {
                modelInfo.innerHTML = "Loading, please wait..";
                $.ajax({
                    url: "/casc/moreInfo?filedataid=" + id,
                    type: 'GET',
                    success: function (data) {
                        var filenameInput = document.getElementById("filename");
                        filenameInput.value = name;

                        var modelInfo = document.getElementById("modelInfo");
                        modelInfo.innerHTML = data;

                        var modelPreview = document.getElementById("modelPreview");

                        if (name.endsWith(".m2")) {
                            modelPreview.innerHTML = "<iframe src='/mv/?filedataid=" + id + "&embed=true' style='width: 100%; height: 500px; border: none;'></iframe>";
                        } else if (name.endsWith(".wmo")) {
                            modelPreview.innerHTML = "<iframe src='/mv/?filedataid=" + id + "&type=wmo&embed=true' style='width: 100%; height: 500px; border: none;'></iframe>";
                        }
                    }
                });
            }

            document.getElementById("filename").oninput = function () {
                var filenameInput = document.getElementById("filename");
                var name = filenameInput.value;
                document.getElementById("nameButton").disabled = false;

                if (!name.endsWith(".m2") && !name.endsWith(".wmo") && !name.endsWith(".blp")) {
                    filenameInput.classList.add('is-invalid');
                    filenameInput.classList.remove('is-valid');
                    document.getElementById("nameButton").disabled = true;
                } else {
                    fetch('/casc/fileCheck?search=' + name, {
                        method: 'GET'
                    }).then(function (response) {
                        return response.text();
                    }).then(function (data) {
                        if (data == "true") {
                            filenameInput.classList.add('is-invalid');
                            filenameInput.classList.remove('is-valid');
                        } else {
                            filenameInput.classList.remove('is-invalid');
                            filenameInput.classList.add('is-valid');
                        }
                    });
                }

                // send request to casc/fileAutocomplete with fetch
                fetch('/casc/directoryAC?search=' + name.replace(".m2", ""), {
                    method: 'GET'
                }).then(function (response) {
                    return response.json();
                }).then(function (results) {
                    var html = "";
                    for (var i = 0; i < results.length; i++) {
                        const resultAC = results[i];
                        html += resultAC + "<br>";
                    }
                    document.getElementById("overlay").innerHTML = html;
                });
            }

            document.getElementById("nameButton").onclick = function () {
                var filenameInput = document.getElementById("filename");
                var name = filenameInput.value;
                lastName = name;
                if (name) {
                    $.ajax({
                        url: "/naming/singleFile?id=" + Elements.currentID + "&name=" + encodeURIComponent(name),
                        type: 'GET',
                        success: function (data) {
                            var numResults = data.split('\n').length;
                            if (data.length == 0)
                                numResults = 0;

                            resultTitle.innerHTML = "Result (" + numResults + " names)";
                            result.innerHTML = data;
                        }
                    });

                    // update datatable
                    var table = $('#files').DataTable();
                    var row = table.row('.selected');
                    var data = row.data();
                    data[1] = name;
                    row.data(data).draw(false);
                }
            }

            fetch('/naming/getNewFiles', {
                method: 'GET'
            }).then(function (response) {
                return response.text();
            }).then(function (data) {
                document.getElementById("result").innerHTML = data;
                if (data.length < 3)
                    resultTitle.innerHTML = "Results";
                else
                    resultTitle.innerHTML = "Result (" + (data.split('\n').length) + " names)";
                    
            });

            var tabEl = document.querySelectorAll('a[data-bs-toggle="tab"]');
            for (let i = 0; i < tabEl.length; i++) {
                tabEl[i].addEventListener('shown.bs.tab', function (event) {
                    if (event.target.text == "Manual models") {
                        document.getElementById("overlay").style.display = 'block';
                    } else {
                        document.getElementById("overlay").style.display = 'none';
                    }
                })
            }
          
        }());

    </script>
    <link href="/css/files.css" rel="stylesheet">
</body>
</html>

